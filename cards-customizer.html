<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>تخصيص موقع الاسم على البطاقات</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal&family=Amiri&family=Cairo&display=swap" rel="stylesheet">
  <style>
    body {
      direction: rtl;
      font-family: 'Tajawal', sans-serif;
      background-color: #f9f9f9;
      padding: 20px;
      text-align: center;
    }
    h1 {
      color: #006699;
    }
    select, input[type="number"], input[type="color"] {
      margin: 10px;
      padding: 6px;
      font-family: inherit;
    }
    canvas {
      border: 1px solid #ccc;
      margin-top: 20px;
      max-width: 100%;
      cursor: move;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #006699;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>تخصيص موقع الاسم على البطاقة</h1>
  <label>اختر البطاقة:
    <select id="designSelect" onchange="loadDesign()">
      <option value="1">تصميم 1</option>
      <option value="2">تصميم 2</option>
      <option value="3">تصميم 3</option>
      <option value="4">تصميم 4</option>
      <option value="5">تصميم 5</option>
      <option value="6">تصميم 6</option>
    </select>
  </label><br>
  <label>الحجم: <input type="number" id="fontSize" value="30"></label>
  <label>اللون: <input type="color" id="fontColor" value="#000000"></label>
  <label>الخط:
    <select id="fontFamily">
      <option value="Tajawal">Tajawal</option>
      <option value="Amiri">Amiri</option>
      <option value="Cairo">Cairo</option>
    </select>
  </label>
  <label>X: <input type="number" id="xCoord"></label>
  <label>Y: <input type="number" id="yCoord"></label><br>
  <button onclick="saveCurrentDesign()">💾 حفظ إعدادات التصميم الحالي</button>

  <canvas id="previewCanvas" width="600" height="800"></canvas><br>
  <button onclick="downloadSettings()">📥 تحميل nameSettings.js</button>

  <p id="savedList"></p>

  <script>
    const settings = {};
    let isDragging = false;
    let currentDesign = 1;
    let imageCache = {};

    function loadDesign() {
      currentDesign = parseInt(document.getElementById("designSelect").value);
      const canvas = document.getElementById("previewCanvas");
      const ctx = canvas.getContext("2d");
      const img = new Image();
      img.src = `images/design${currentDesign}.jpg`;
      img.onload = () => {
        imageCache[currentDesign] = img;
        canvas.width = img.width;
        canvas.height = img.height;

        const s = settings[currentDesign] || {
          fontSize: 30,
          fontColor: "#000000",
          x: Math.floor(img.width / 2),
          y: Math.floor(img.height / 2),
        };

        document.getElementById("fontSize").value = s.fontSize;
        document.getElementById("fontColor").value = s.fontColor;
        document.getElementById("xCoord").value = s.x;
        document.getElementById("yCoord").value = s.y;

        redrawCanvas(ctx, img);
      };

      const canvas = document.getElementById("previewCanvas");
      canvas.onmousedown = function(e) {
        isDragging = true;
        updateCoordsFromMouse(e);
      };
      canvas.onmouseup = () => isDragging = false;
      canvas.onmouseout = () => isDragging = false;
      canvas.onmousemove = function(e) {
        if (isDragging) {
          updateCoordsFromMouse(e);
        }
      };
    }

    function updateCoordsFromMouse(e) {
      const canvas = document.getElementById("previewCanvas");
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      document.getElementById("xCoord").value = Math.round(x);
      document.getElementById("yCoord").value = Math.round(y);
      redrawCanvas(canvas.getContext("2d"), imageCache[currentDesign]);
    }

    function redrawCanvas(ctx, img) {
      ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
      ctx.drawImage(img, 0, 0);
      ctx.font = `bold ${document.getElementById("fontSize").value}px ${document.getElementById("fontFamily").value}`;
      ctx.fillStyle = document.getElementById("fontColor").value;
      ctx.textAlign = "center";
      ctx.fillText("مثال على الاسم", parseInt(document.getElementById("xCoord").value), parseInt(document.getElementById("yCoord").value));
    }

    function saveCurrentDesign() {
      const d = currentDesign;
      settings[d] = {
        fontSize: parseInt(document.getElementById("fontSize").value),
        fontColor: document.getElementById("fontColor").value,
        x: parseInt(document.getElementById("xCoord").value),
        y: parseInt(document.getElementById("yCoord").value)
      };
      document.getElementById("savedList").innerText = `✅ تم حفظ إعدادات التصاميم: ${Object.keys(settings).join(", ")}`;
    }

    function downloadSettings() {
      const blob = new Blob([
        "const nameSettings = " + JSON.stringify(settings, null, 2) + ";"
      ], { type: "application/javascript" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "nameSettings.js";
      link.click();
    }

    document.querySelectorAll("input, select").forEach(el => {
      el.addEventListener("input", () => {
        redrawCanvas(document.getElementById("previewCanvas").getContext("2d"), imageCache[currentDesign]);
      });
    });

    window.onload = loadDesign;
  </script>
</body>
</html>
